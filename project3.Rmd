---
title: "Project3"
author: "Group 6"
date: "4/2/2020"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(caret)
library(MASS)
library(BART)
```


```{r}
absent <-read.csv("Absenteeism_at_work2.csv")
str(absent)
```

```{r}
##Converting into factors
#absent$ï..ID<- as.factor(absent$ï..ID)
absent$Reason.for.absence <- as.factor(absent$Reason.for.absence)
absent$Month.of.absence <- as.factor(absent$Month.of.absence)
absent$Day.of.the.week <- as.factor(absent$Day.of.the.week)
absent$Seasons <- as.factor(absent$Season)
absent$Disciplinary.failure <-as.factor(absent$Disciplinary.failure)
absent$Education <- as.factor(absent$Education)
absent$Social.drinker <-as.factor(absent$Social.drinker)
absent$Social.smoker <-as.factor(absent$Social.smoker)
absent$ï..ID  <- NULL
absent$Work.load.Average.day<-as.numeric(absent$Work.load.Average.day)
absent$Month.of.absence<- NULL
absent$Weight<- NULL
absent$is_Thur<-if_else(absent$Day.of.the.week==5,1,0)
absent$Day.of.the.week<-NULL
absent$is_Seas4<-if_else(absent$Seasons==4,1,0)
absent$Seasons<-NULL
#absent$is_Educ3<-if_else(absent$Education==3,1,0) Once I do this, Seasons and Education3 no longer significant
#absent$Education<-NULL
absent$Transportation.expense<-NULL
absent$Social.drinker<-NULL
absent$Disciplinary.failure<-NULL

lm.model <- lm( Absenteeism.time.in.hours ~., data=absent)
stepmodel <- step(lm.model, direction = "forward")
summary(stepmodel)

lm1 <-lm(Absenteeism.time.in.hours ~.,data=absent) %>% stepAIC(trace = FALSE, direction = "forward")
summary(lm1)
# ANN/Decision tree/Logistic Rminer?
```

# ANN/Decision tree/Logistic Rminer?
Reason for absense: Overall reasons for absence are significant, but some reasons have more of impact than others. I guess that's because some reasons are commonplace or popular while others are more personal and not widely used.

Month of absence:It is not a significant factor, however by common sense, we would expect people to take more leaves during holiday season,such as Christams and New Year Holiday,and take less leaves after that, which is the first quarter of the year.

Day of the Week: Comparatively, people take more leaves in the first few days of the week, one possible explanation is people tend to have "Monday Syndrome", and in the last few workdays(Thursdays and Fridays) they tend to work harder and longer to finish the work in time in order to have a good weekend.

Seasons: Similar to Month of absense. We can see people take longer leaves during season 2,3,4 than season 1, I guess that's because in season 1 most people just come back from Christmas and New Year Holiday, and there are less holidays in season 1.

Transportation expense: We expected that people who need more transportation expenses tend to have more absense. Interestingly, the coefficient is postive but really small, also it is not significant. I guess this is because most people won't consider transportation expenses when they are thinking if they want to go to work today (since you can make more money than transportation expenses if you work)

Distance from Residence to Work: The result is kind of counterintuitive since we expectd that people who liver closer to the company will show up more compared to people who don't. Though it is not significant, the relationship is negative. Maybe it is becuase people who liver closer tend to procrastinate and leave home later than people who live farther away and get up earlier.

Service time:Intuitively, people who do more volunteer work would of course ask for more leaves than people who don't.

Age:Older people may ask for more leaves due to health issues, or because they are more senior so the legwork can be handed to juniors and they can leave earlier.

Work load Average day:The coefficient is negative, which is straigtforward because the more workload you have the less likely you will take a break.

Hit target:If you have hit the target of your manager/your team, you can be rewarded with more breaks.

Education:The higher degree you have, the more capable you are and therefore, you will need to handle more challenging work that may require more time.

Son:It is pretty straightforward that more kids means people need more commitment to the family and more parental leaves, therefore the relationship is negative.

Social drinker: ?

Social smoker: ?

Pet:We expected it to be similar to "Son", however the relationship is negative. One possible interpreation is that people who have pets are mostly young people who don't have kids. Also, pets need less dedication that kids(since you don't need to cook for pets and tutor them)



Weight, Height, Body mass index:We expected a healthy body would save people from taking sick leaves. Weight and height are very insignificant since people with different heights have different healthy weights. BMI index is also significant since a good BMI is between 18.5-24.9——neither a too high or too low BMI index is good.


Weight, Height, Body mass index:We expected a healthy body would save people from taking sick leaves. Weight and height are very insignificant since people with different heights have different healthy weights. BMI index is also significant since a good BMI is between 18.5-24.9——neither a too high or too low BMI index is good.

Weight, Height, Body mass index:We expected a healthy body would save people from taking sick leaves. Weight and height are very insignificant since people with different heights have different healthy weights. BMI index is also significant since a good BMI is between 18.5-24.9——neither a too high or too low BMI index is good.


Preparing the data
```{r}
##Randomizing the data
set.seed(65)
absent_r<-absent[sample(nrow(absent)),]

##Turning factors into binary
absent_mm <- as.data.frame(model.matrix(~ . -1, absent_r)) ##Breaking factors into dummy variables


normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

##Normalizing every variable except output
absent_n <- as.data.frame(lapply(subset(absent_mm,select=c(-Absenteeism.time.in.hours)), normalize))
```
## ANN Model

```{r}
##Dividing response variable into categories 
absent$timecat <- absent$Absenteeism.time.in.hours
absent$timecat <- ifelse(absent$timecat == 0, "not.absent", ifelse (absent$timecat>0 & absent$timecat<8, "less.than.day", ifelse(absent$timecat>=8 & absent$timecat<=32, "one.to.four.days", ifelse(absent$timecat>32 & absent$timecat<=56, "one.week", ifelse(absent$timecat>56 & absent$timecat<=96, "two.week", "three.week")))))
          
absent$timecat <- as.factor(absent$timecat)
absent2 <- absent #creating an alternate data set for classification models 
absent2$Absenteeism.time.in.hours <- NULL


##Randomizing the data
set.seed(65)
abs_rand<-absent2[sample(nrow(absent)),]
View(abs_rand)

##Turning factors into binary
abs_mm <- as.data.frame(model.matrix(~ . -1, abs_rand[-15])) ##Breaking factors into dummy variables
View(abs_mm)

normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

##Normalizing every variable except output
abs_norm <- as.data.frame(lapply(abs_mm, normalize))
absent2 <- cbind(abs_norm, class.ind(absent2$timecat))

#Separating data into test and train data
library(nnet)
abs_train <- absent2[1:540, ]
abs_test <- absent2[541:740, ]

#Setting up the necessary packages for the ANN model
library(neuralnet)

#Modelling ANN
abs_model <- neuralnet(formula= less.than.day + not.absent + one.to.four.days + one.week + two.week + three.week ~ ., data=abs_train, hidden = 5, threshold = 0.5)
plot(abs_model)
model_results <- compute(abs_model, abs_test[1:43])
pred_strength <- model_results$net.result
summary(pred_strength)
library(caret)
#so now each of the six outputs have to be converted to a binary result but i'm not sure how to interpret these results and determine a threshold to make a result 0 or 1 pls help!
```


